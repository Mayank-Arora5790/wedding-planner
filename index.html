<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wedding Planner - Plan Your Perfect Day</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #d4a5a5;
            --primary-dark: #b88a8a;
            --secondary: #f5e6e8;
            --accent: #c77d7d;
            --text-dark: #333;
            --text-light: #666;
            --bg-light: #fafafa;
            --white: #ffffff;
            --border: #e0e0e0;
            --success: #4caf50;
            --warning: #ff9800;
            --danger: #f44336;
            --shadow: rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--secondary) 0%, var(--bg-light) 100%);
            color: var(--text-dark);
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
            color: var(--white);
            padding: 30px 0;
            box-shadow: 0 4px 6px var(--shadow);
            margin-bottom: 30px;
        }

        header .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 300;
            letter-spacing: 2px;
        }

        h1 span {
            font-weight: 700;
        }

        .nav-tabs {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
            background: var(--white);
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 10px var(--shadow);
            margin-bottom: 30px;
        }

        .nav-tab {
            padding: 12px 24px;
            background: var(--white);
            border: 2px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            color: var(--text-dark);
        }

        .nav-tab:hover {
            background: var(--secondary);
            border-color: var(--primary);
        }

        .nav-tab.active {
            background: var(--primary);
            color: var(--white);
            border-color: var(--primary);
        }

        .section {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .card {
            background: var(--white);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px var(--shadow);
            transition: transform 0.2s ease;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px var(--shadow);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--secondary);
        }

        .card-header h2 {
            color: var(--primary-dark);
            font-size: 1.8rem;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            font-size: 0.95rem;
        }

        .btn-primary {
            background: var(--primary);
            color: var(--white);
        }

        .btn-primary:hover {
            background: var(--primary-dark);
        }

        .btn-success {
            background: var(--success);
            color: var(--white);
        }

        .btn-success:hover {
            background: #45a049;
        }

        .btn-danger {
            background: var(--danger);
            color: var(--white);
        }

        .btn-danger:hover {
            background: #da190b;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 0.85rem;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: var(--text-dark);
            font-weight: 500;
        }

        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid var(--border);
            border-radius: 6px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .item-card {
            background: var(--bg-light);
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid var(--primary);
        }

        .item-card h3 {
            color: var(--primary-dark);
            margin-bottom: 10px;
        }

        .item-card p {
            color: var(--text-light);
            margin: 5px 0;
            font-size: 0.95rem;
        }

        .item-actions {
            margin-top: 10px;
            display: flex;
            gap: 10px;
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
            margin-top: 5px;
        }

        .badge-success {
            background: #c8e6c9;
            color: #2e7d32;
        }

        .badge-warning {
            background: #ffe0b2;
            color: #e65100;
        }

        .badge-danger {
            background: #ffcdd2;
            color: #c62828;
        }

        .badge-info {
            background: #e1bee7;
            color: #6a1b9a;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
            color: var(--white);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 12px var(--shadow);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.95rem;
            opacity: 0.9;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--white);
            padding: 30px;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .close-modal {
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-light);
        }

        .close-modal:hover {
            color: var(--danger);
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            margin: 10px 0;
        }

        .checkbox-group input[type="checkbox"] {
            width: auto;
            margin-right: 10px;
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: var(--border);
            border-radius: 15px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--success) 0%, #66bb6a 100%);
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-weight: 600;
            font-size: 0.85rem;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        th {
            background: var(--secondary);
            color: var(--text-dark);
            font-weight: 600;
        }

        tr:hover {
            background: var(--bg-light);
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: var(--text-light);
        }

        .empty-state svg {
            width: 100px;
            height: 100px;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.8rem;
            }

            .nav-tabs {
                flex-direction: column;
            }

            .nav-tab, .nav-tabs .btn {
                width: 100%;
                text-align: center;
                margin-left: 0 !important;
            }

            .grid {
                grid-template-columns: 1fr;
            }

            .stats {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>üíç <span>Wedding Planner</span></h1>
            <p style="opacity: 0.9;">Plan Your Perfect Day</p>
        </div>
    </header>

    <div class="container">
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showSection('dashboard')">üìä Dashboard</button>
            <button class="nav-tab" onclick="showSection('guests')">üë• Guest List</button>
            <button class="nav-tab" onclick="showSection('venues')">üèõÔ∏è Venues</button>
            <button class="nav-tab" onclick="showSection('shopping')">üõçÔ∏è Shopping</button>
            <button class="nav-tab" onclick="showSection('food')">üçΩÔ∏è Food & Catering</button>
            <button class="nav-tab" onclick="showSection('budget')">üí∞ Budget</button>
            <button class="nav-tab" onclick="showSection('timeline')">üìÖ Timeline</button>
            <button class="btn btn-success" onclick="exportData()" style="margin-left: auto;">üíæ Export Data</button>
            <button class="btn btn-primary" onclick="document.getElementById('importFile').click()">üìÇ Import Data</button>
            <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importData(event)">
        </div>

        <!-- Dashboard Section -->
        <div id="dashboard" class="section active">
            <div class="card" style="background: linear-gradient(135deg, #fff3cd 0%, #fff9e6 100%); border-left: 4px solid #ffc107; margin-bottom: 20px;">
                <p style="margin: 0;"><strong>üí° Tip:</strong> Your data is automatically saved in your browser. Click <strong>"üíæ Export Data"</strong> above to download a backup file that you can use on other devices or keep as a backup!</p>
            </div>

            <div class="stats" id="dashboardStats"></div>
            
            <div class="card">
                <div class="card-header">
                    <h2>Tasks by Person</h2>
                </div>
                <div id="tasksByPerson"></div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2>Quick Overview</h2>
                </div>
                <div id="quickOverview"></div>
            </div>
        </div>

        <!-- Guest List Section -->
        <div id="guests" class="section">
            <div class="card">
                <div class="card-header">
                    <h2>Guest List</h2>
                    <button class="btn btn-primary" onclick="openGuestModal()">+ Add Guest</button>
                </div>
                <div id="guestStats"></div>
                <div id="guestsList"></div>
            </div>
        </div>

        <!-- Venues Section -->
        <div id="venues" class="section">
            <div class="card">
                <div class="card-header">
                    <h2>Venue Options</h2>
                    <button class="btn btn-primary" onclick="openVenueModal()">+ Add Venue</button>
                </div>
                <div class="grid" id="venuesList"></div>
            </div>
        </div>

        <!-- Shopping Section -->
        <div id="shopping" class="section">
            <div class="card">
                <div class="card-header">
                    <h2>Shopping Checklist</h2>
                    <button class="btn btn-primary" onclick="openShoppingModal()">+ Add Item</button>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="shoppingProgress">0%</div>
                </div>
                <div id="shoppingList"></div>
            </div>
        </div>

        <!-- Food Section -->
        <div id="food" class="section">
            <div class="card">
                <div class="card-header">
                    <h2>Food & Catering</h2>
                    <button class="btn btn-primary" onclick="openFoodModal()">+ Add Menu Item</button>
                </div>
                <div class="grid" id="foodList"></div>
            </div>
        </div>

        <!-- Budget Section -->
        <div id="budget" class="section">
            <div class="card">
                <div class="card-header">
                    <h2>Budget Tracker</h2>
                    <button class="btn btn-primary" onclick="openBudgetModal()">+ Add Expense</button>
                </div>
                <div id="budgetSummary"></div>
                <div id="budgetList"></div>
            </div>
        </div>

        <!-- Timeline Section -->
        <div id="timeline" class="section">
            <div class="card">
                <div class="card-header">
                    <h2>Wedding Timeline</h2>
                    <button class="btn btn-primary" onclick="openTimelineModal()">+ Add Event</button>
                </div>
                <div id="timelineList"></div>
            </div>
        </div>
    </div>

    <!-- Guest Modal -->
    <div id="guestModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add Guest</h2>
                <span class="close-modal" onclick="closeModal('guestModal')">&times;</span>
            </div>
            <form onsubmit="addGuest(event)">
                <div class="form-group">
                    <label>Name *</label>
                    <input type="text" id="guestName" required>
                </div>
                <div class="form-group">
                    <label>Guest Side *</label>
                    <select id="guestSide" required>
                        <option value="">Select Side</option>
                        <option value="bride">Bride's Side</option>
                        <option value="groom">Groom's Side</option>
                        <option value="both">Both/Mutual Friends</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="guestEmail">
                </div>
                <div class="form-group">
                    <label>Phone</label>
                    <input type="tel" id="guestPhone">
                </div>
                <div class="form-group">
                    <label>RSVP Status</label>
                    <select id="guestRsvp">
                        <option value="pending">Pending</option>
                        <option value="confirmed">Confirmed</option>
                        <option value="declined">Declined</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Number of Persons (including this guest)</label>
                    <input type="number" id="guestPersons" min="1" value="1" required>
                    <small style="color: var(--text-light); display: block; margin-top: 5px;">1 = guest only, 2 = guest + 1 person, 3 = guest + 2 people, etc.</small>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="guestRoomRequired">
                    <label for="guestRoomRequired">Room/Accommodation Required</label>
                </div>
                <div class="form-group">
                    <label>Dietary Restrictions</label>
                    <input type="text" id="guestDiet" placeholder="e.g., Vegetarian, Gluten-free">
                </div>
                <button type="submit" class="btn btn-success" style="width: 100%;">Add Guest</button>
            </form>
        </div>
    </div>

    <!-- Venue Modal -->
    <div id="venueModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add Venue</h2>
                <span class="close-modal" onclick="closeModal('venueModal')">&times;</span>
            </div>
            <form onsubmit="addVenue(event)">
                <div class="form-group">
                    <label>Venue Name *</label>
                    <input type="text" id="venueName" required>
                </div>
                <div class="form-group">
                    <label>Location *</label>
                    <input type="text" id="venueLocation" required>
                </div>
                <div class="form-group">
                    <label>Capacity</label>
                    <input type="number" id="venueCapacity" min="0">
                </div>
                <div class="form-group">
                    <label>Price</label>
                    <input type="number" id="venuePrice" min="0" step="0.01">
                </div>
                <div class="form-group">
                    <label>Contact</label>
                    <input type="text" id="venueContact">
                </div>
                <div class="form-group">
                    <label>Status</label>
                    <select id="venueStatus">
                        <option value="considering">Considering</option>
                        <option value="contacted">Contacted</option>
                        <option value="booked">Booked</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Responsible For Follow-up</label>
                    <input type="text" id="venueOwner" placeholder="e.g., Sarah, John">
                </div>
                <div class="form-group">
                    <label>Notes</label>
                    <textarea id="venueNotes"></textarea>
                </div>
                <button type="submit" class="btn btn-success" style="width: 100%;">Add Venue</button>
            </form>
        </div>
    </div>

    <!-- Shopping Modal -->
    <div id="shoppingModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add Shopping Item</h2>
                <span class="close-modal" onclick="closeModal('shoppingModal')">&times;</span>
            </div>
            <form onsubmit="addShoppingItem(event)">
                <div class="form-group">
                    <label>Item Name *</label>
                    <input type="text" id="shoppingItem" required>
                </div>
                <div class="form-group">
                    <label>Category</label>
                    <select id="shoppingCategory">
                        <option value="decorations">Decorations</option>
                        <option value="attire">Attire</option>
                        <option value="favors">Favors</option>
                        <option value="stationery">Stationery</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Estimated Cost</label>
                    <input type="number" id="shoppingCost" min="0" step="0.01">
                </div>
                <div class="form-group">
                    <label>Priority</label>
                    <select id="shoppingPriority">
                        <option value="low">Low</option>
                        <option value="medium">Medium</option>
                        <option value="high">High</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Assigned To</label>
                    <input type="text" id="shoppingOwner" placeholder="e.g., Sarah, John, Mom">
                </div>
                <div class="form-group">
                    <label>Notes</label>
                    <textarea id="shoppingNotes"></textarea>
                </div>
                <button type="submit" class="btn btn-success" style="width: 100%;">Add Item</button>
            </form>
        </div>
    </div>

    <!-- Food Modal -->
    <div id="foodModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add Menu Item</h2>
                <span class="close-modal" onclick="closeModal('foodModal')">&times;</span>
            </div>
            <form onsubmit="addFoodItem(event)">
                <div class="form-group">
                    <label>Dish Name *</label>
                    <input type="text" id="foodName" required>
                </div>
                <div class="form-group">
                    <label>Course</label>
                    <select id="foodCourse">
                        <option value="appetizer">Appetizer</option>
                        <option value="main">Main Course</option>
                        <option value="dessert">Dessert</option>
                        <option value="beverage">Beverage</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Type</label>
                    <select id="foodType">
                        <option value="vegetarian">Vegetarian</option>
                        <option value="non-vegetarian">Non-Vegetarian</option>
                        <option value="vegan">Vegan</option>
                        <option value="gluten-free">Gluten-Free</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Cost per Plate</label>
                    <input type="number" id="foodCost" min="0" step="0.01">
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea id="foodDescription"></textarea>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="foodSelected">
                    <label for="foodSelected">Selected for Menu</label>
                </div>
                <button type="submit" class="btn btn-success" style="width: 100%;">Add Menu Item</button>
            </form>
        </div>
    </div>

    <!-- Budget Modal -->
    <div id="budgetModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add Expense</h2>
                <span class="close-modal" onclick="closeModal('budgetModal')">&times;</span>
            </div>
            <form onsubmit="addBudgetItem(event)">
                <div class="form-group">
                    <label>Category *</label>
                    <select id="budgetCategory" required>
                        <option value="venue">Venue</option>
                        <option value="catering">Catering</option>
                        <option value="photography">Photography</option>
                        <option value="decorations">Decorations</option>
                        <option value="attire">Attire</option>
                        <option value="entertainment">Entertainment</option>
                        <option value="flowers">Flowers</option>
                        <option value="transportation">Transportation</option>
                        <option value="invitations">Invitations</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Description *</label>
                    <input type="text" id="budgetDescription" required>
                </div>
                <div class="form-group">
                    <label>Estimated Cost *</label>
                    <input type="number" id="budgetEstimated" min="0" step="0.01" required>
                </div>
                <div class="form-group">
                    <label>Actual Cost</label>
                    <input type="number" id="budgetActual" min="0" step="0.01">
                </div>
                <div class="form-group">
                    <label>Responsible Person</label>
                    <input type="text" id="budgetOwner" placeholder="e.g., Sarah, John, Parents">
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="budgetPaid">
                    <label for="budgetPaid">Paid</label>
                </div>
                <button type="submit" class="btn btn-success" style="width: 100%;">Add Expense</button>
            </form>
        </div>
    </div>

    <!-- Timeline Modal -->
    <div id="timelineModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add Timeline Event</h2>
                <span class="close-modal" onclick="closeModal('timelineModal')">&times;</span>
            </div>
            <form onsubmit="addTimelineItem(event)">
                <div class="form-group">
                    <label>Event Name *</label>
                    <input type="text" id="timelineEvent" required>
                </div>
                <div class="form-group">
                    <label>Date *</label>
                    <input type="date" id="timelineDate" required>
                </div>
                <div class="form-group">
                    <label>Time</label>
                    <input type="time" id="timelineTime">
                </div>
                <div class="form-group">
                    <label>Location</label>
                    <input type="text" id="timelineLocation">
                </div>
                <div class="form-group">
                    <label>Assigned To</label>
                    <input type="text" id="timelineOwner" placeholder="e.g., Sarah, John, Wedding Planner">
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea id="timelineDescription"></textarea>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="timelineCompleted">
                    <label for="timelineCompleted">Completed</label>
                </div>
                <button type="submit" class="btn btn-success" style="width: 100%;">Add Event</button>
            </form>
        </div>
    </div>

    <script>
        // Data Storage
        let data = {
            guests: [],
            venues: [],
            shopping: [],
            food: [],
            budget: [],
            timeline: []
        };

        // Edit mode tracking
        let editMode = {
            isEditing: false,
            section: null,
            itemId: null
        };

        // Load data from localStorage
        function loadData() {
            const saved = localStorage.getItem('weddingPlannerData');
            if (saved) {
                data = JSON.parse(saved);
            }
            renderAll();
        }

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('weddingPlannerData', JSON.stringify(data));
            renderAll();
        }

        // Navigation
        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.getElementById(sectionId).classList.add('active');
            event.target.classList.add('active');
        }

        // Modal Functions
        function openGuestModal() {
            editMode = { isEditing: false, section: null, itemId: null };
            document.querySelector('#guestModal h2').textContent = 'Add Guest';
            document.querySelector('#guestModal button[type="submit"]').textContent = 'Add Guest';
            document.getElementById('guestModal').querySelector('form').reset();
            document.getElementById('guestModal').classList.add('active');
        }

        function openVenueModal() {
            editMode = { isEditing: false, section: null, itemId: null };
            document.querySelector('#venueModal h2').textContent = 'Add Venue';
            document.querySelector('#venueModal button[type="submit"]').textContent = 'Add Venue';
            document.getElementById('venueModal').querySelector('form').reset();
            document.getElementById('venueModal').classList.add('active');
        }

        function openShoppingModal() {
            editMode = { isEditing: false, section: null, itemId: null };
            document.querySelector('#shoppingModal h2').textContent = 'Add Shopping Item';
            document.querySelector('#shoppingModal button[type="submit"]').textContent = 'Add Item';
            document.getElementById('shoppingModal').querySelector('form').reset();
            document.getElementById('shoppingModal').classList.add('active');
        }

        function openFoodModal() {
            editMode = { isEditing: false, section: null, itemId: null };
            document.querySelector('#foodModal h2').textContent = 'Add Menu Item';
            document.querySelector('#foodModal button[type="submit"]').textContent = 'Add Menu Item';
            document.getElementById('foodModal').querySelector('form').reset();
            document.getElementById('foodModal').classList.add('active');
        }

        function openBudgetModal() {
            editMode = { isEditing: false, section: null, itemId: null };
            document.querySelector('#budgetModal h2').textContent = 'Add Expense';
            document.querySelector('#budgetModal button[type="submit"]').textContent = 'Add Expense';
            document.getElementById('budgetModal').querySelector('form').reset();
            document.getElementById('budgetModal').classList.add('active');
        }

        function openTimelineModal() {
            editMode = { isEditing: false, section: null, itemId: null };
            document.querySelector('#timelineModal h2').textContent = 'Add Timeline Event';
            document.querySelector('#timelineModal button[type="submit"]').textContent = 'Add Event';
            document.getElementById('timelineModal').querySelector('form').reset();
            document.getElementById('timelineModal').classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
            editMode = { isEditing: false, section: null, itemId: null };
        }

        // Guest Functions
        function addGuest(event) {
            event.preventDefault();
            
            if (editMode.isEditing && editMode.section === 'guest') {
                // Edit existing guest
                const guest = data.guests.find(g => g.id === editMode.itemId);
                if (guest) {
                    guest.name = document.getElementById('guestName').value;
                    guest.side = document.getElementById('guestSide').value;
                    guest.email = document.getElementById('guestEmail').value;
                    guest.phone = document.getElementById('guestPhone').value;
                    guest.rsvp = document.getElementById('guestRsvp').value;
                    guest.persons = parseInt(document.getElementById('guestPersons').value) || 1;
                    guest.roomRequired = document.getElementById('guestRoomRequired').checked;
                    guest.diet = document.getElementById('guestDiet').value;
                }
            } else {
                // Add new guest
                const guest = {
                    id: Date.now(),
                    name: document.getElementById('guestName').value,
                    side: document.getElementById('guestSide').value,
                    email: document.getElementById('guestEmail').value,
                    phone: document.getElementById('guestPhone').value,
                    rsvp: document.getElementById('guestRsvp').value,
                    persons: parseInt(document.getElementById('guestPersons').value) || 1,
                    roomRequired: document.getElementById('guestRoomRequired').checked,
                    diet: document.getElementById('guestDiet').value
                };
                data.guests.push(guest);
            }
            
            saveData();
            closeModal('guestModal');
            event.target.reset();
        }

        function editGuest(id) {
            const guest = data.guests.find(g => g.id === id);
            if (!guest) return;

            editMode = { isEditing: true, section: 'guest', itemId: id };
            
            document.getElementById('guestName').value = guest.name;
            document.getElementById('guestSide').value = guest.side || '';
            document.getElementById('guestEmail').value = guest.email || '';
            document.getElementById('guestPhone').value = guest.phone || '';
            document.getElementById('guestRsvp').value = guest.rsvp;
            // Handle legacy plusOne field or new persons field
            if (guest.persons) {
                document.getElementById('guestPersons').value = guest.persons;
            } else if (guest.plusOne === 'yes') {
                document.getElementById('guestPersons').value = 2;
            } else {
                document.getElementById('guestPersons').value = 1;
            }
            document.getElementById('guestRoomRequired').checked = guest.roomRequired || false;
            document.getElementById('guestDiet').value = guest.diet || '';
            
            document.querySelector('#guestModal h2').textContent = 'Edit Guest';
            document.querySelector('#guestModal button[type="submit"]').textContent = 'Update Guest';
            document.getElementById('guestModal').classList.add('active');
        }

        function deleteGuest(id) {
            if (confirm('Are you sure you want to delete this guest?')) {
                data.guests = data.guests.filter(g => g.id !== id);
                saveData();
            }
        }

        function renderGuests() {
            const container = document.getElementById('guestsList');
            const statsContainer = document.getElementById('guestStats');
            
            if (data.guests.length === 0) {
                statsContainer.innerHTML = '';
                container.innerHTML = '<div class="empty-state"><p>No guests added yet. Start building your guest list!</p></div>';
                return;
            }

            // Calculate guest statistics
            const brideGuests = data.guests.filter(g => g.side === 'bride').length;
            const groomGuests = data.guests.filter(g => g.side === 'groom').length;
            const bothGuests = data.guests.filter(g => g.side === 'both').length;
            const roomsNeeded = data.guests.filter(g => g.roomRequired).length;
            
            // Calculate total persons
            let totalPersons = 0;
            let bridePersons = 0;
            let groomPersons = 0;
            let bothPersons = 0;
            
            data.guests.forEach(guest => {
                let persons = 1;
                if (guest.persons) {
                    persons = guest.persons;
                } else if (guest.plusOne === 'yes') {
                    persons = 2;
                }
                
                totalPersons += persons;
                
                if (guest.side === 'bride') {
                    bridePersons += persons;
                } else if (guest.side === 'groom') {
                    groomPersons += persons;
                } else if (guest.side === 'both') {
                    bothPersons += persons;
                }
            });

            // Display statistics
            statsContainer.innerHTML = `
                <div class="stats" style="margin-bottom: 20px;">
                    <div class="stat-card" style="background: linear-gradient(135deg, #ab47bc 0%, #8e24aa 100%);">
                        <div class="stat-number">${totalPersons}</div>
                        <div class="stat-label">üë• Total Guests</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #f8bbd0 0%, #f48fb1 100%);">
                        <div class="stat-number">${bridePersons}</div>
                        <div class="stat-label">üë∞ Bride's Side</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #90caf9 0%, #64b5f6 100%);">
                        <div class="stat-number">${groomPersons}</div>
                        <div class="stat-label">ü§µ Groom's Side</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #ce93d8 0%, #ba68c8 100%);">
                        <div class="stat-number">${bothPersons}</div>
                        <div class="stat-label">üíë Both/Mutual</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #ffab91 0%, #ff8a65 100%);">
                        <div class="stat-number">${roomsNeeded}</div>
                        <div class="stat-label">üè® Rooms Needed</div>
                    </div>
                </div>
            `;

            let html = '<table><thead><tr><th>Name</th><th>Side</th><th>Contact</th><th>RSVP</th><th># Persons</th><th>Room</th><th>Diet</th><th>Actions</th></tr></thead><tbody>';
            data.guests.forEach(guest => {
                const rsvpBadge = guest.rsvp === 'confirmed' ? 'badge-success' : guest.rsvp === 'declined' ? 'badge-danger' : 'badge-warning';
                const sideBadge = guest.side === 'bride' ? 'badge-info' : guest.side === 'groom' ? 'badge-success' : 'badge-warning';
                const sideLabel = guest.side === 'bride' ? 'üë∞ Bride' : guest.side === 'groom' ? 'ü§µ Groom' : guest.side === 'both' ? 'üíë Both' : 'N/A';
                
                // Handle legacy plusOne or new persons field
                let persons = 1;
                if (guest.persons) {
                    persons = guest.persons;
                } else if (guest.plusOne === 'yes') {
                    persons = 2;
                }
                
                html += `
                    <tr>
                        <td><strong>${guest.name}</strong></td>
                        <td><span class="badge ${sideBadge}">${sideLabel}</span></td>
                        <td>${guest.email || guest.phone || 'N/A'}</td>
                        <td><span class="badge ${rsvpBadge}">${guest.rsvp}</span></td>
                        <td><strong>${persons}</strong></td>
                        <td>${guest.roomRequired ? 'üè® Yes' : '‚úó'}</td>
                        <td>${guest.diet || 'None'}</td>
                        <td>
                            <button class="btn btn-primary btn-small" onclick="editGuest(${guest.id})" style="margin-right: 5px;">Edit</button>
                            <button class="btn btn-danger btn-small" onclick="deleteGuest(${guest.id})">Delete</button>
                        </td>
                    </tr>
                `;
            });
            html += '</tbody></table>';
            container.innerHTML = html;
        }

        // Venue Functions
        function addVenue(event) {
            event.preventDefault();
            
            if (editMode.isEditing && editMode.section === 'venue') {
                // Edit existing venue
                const venue = data.venues.find(v => v.id === editMode.itemId);
                if (venue) {
                    venue.name = document.getElementById('venueName').value;
                    venue.location = document.getElementById('venueLocation').value;
                    venue.capacity = document.getElementById('venueCapacity').value;
                    venue.price = document.getElementById('venuePrice').value;
                    venue.contact = document.getElementById('venueContact').value;
                    venue.status = document.getElementById('venueStatus').value;
                    venue.owner = document.getElementById('venueOwner').value;
                    venue.notes = document.getElementById('venueNotes').value;
                }
            } else {
                // Add new venue
                const venue = {
                    id: Date.now(),
                    name: document.getElementById('venueName').value,
                    location: document.getElementById('venueLocation').value,
                    capacity: document.getElementById('venueCapacity').value,
                    price: document.getElementById('venuePrice').value,
                    contact: document.getElementById('venueContact').value,
                    status: document.getElementById('venueStatus').value,
                    owner: document.getElementById('venueOwner').value,
                    notes: document.getElementById('venueNotes').value
                };
                data.venues.push(venue);
            }
            
            saveData();
            closeModal('venueModal');
            event.target.reset();
        }

        function editVenue(id) {
            const venue = data.venues.find(v => v.id === id);
            if (!venue) return;

            editMode = { isEditing: true, section: 'venue', itemId: id };
            
            document.getElementById('venueName').value = venue.name;
            document.getElementById('venueLocation').value = venue.location;
            document.getElementById('venueCapacity').value = venue.capacity || '';
            document.getElementById('venuePrice').value = venue.price || '';
            document.getElementById('venueContact').value = venue.contact || '';
            document.getElementById('venueStatus').value = venue.status;
            document.getElementById('venueOwner').value = venue.owner || '';
            document.getElementById('venueNotes').value = venue.notes || '';
            
            document.querySelector('#venueModal h2').textContent = 'Edit Venue';
            document.querySelector('#venueModal button[type="submit"]').textContent = 'Update Venue';
            document.getElementById('venueModal').classList.add('active');
        }

        function deleteVenue(id) {
            if (confirm('Are you sure you want to delete this venue?')) {
                data.venues = data.venues.filter(v => v.id !== id);
                saveData();
            }
        }

        function renderVenues() {
            const container = document.getElementById('venuesList');
            if (data.venues.length === 0) {
                container.innerHTML = '<div class="empty-state"><p>No venues added yet. Start exploring your options!</p></div>';
                return;
            }

            let html = '';
            data.venues.forEach(venue => {
                const statusBadge = venue.status === 'booked' ? 'badge-success' : venue.status === 'contacted' ? 'badge-warning' : 'badge-info';
                html += `
                    <div class="item-card">
                        <h3>${venue.name}</h3>
                        <p>üìç ${venue.location}</p>
                        ${venue.capacity ? `<p>üë• Capacity: ${venue.capacity}</p>` : ''}
                        ${venue.price ? `<p>üí∞ $${venue.price}</p>` : ''}
                        ${venue.contact ? `<p>üìû ${venue.contact}</p>` : ''}
                        ${venue.owner ? `<p>üë§ Follow-up: ${venue.owner}</p>` : ''}
                        <span class="badge ${statusBadge}">${venue.status}</span>
                        ${venue.notes ? `<p style="margin-top: 10px;"><em>${venue.notes}</em></p>` : ''}
                        <div class="item-actions">
                            <button class="btn btn-primary btn-small" onclick="editVenue(${venue.id})">Edit</button>
                            <button class="btn btn-danger btn-small" onclick="deleteVenue(${venue.id})">Delete</button>
                        </div>
                    </div>
                `;
            });
            container.innerHTML = html;
        }

        // Shopping Functions
        function addShoppingItem(event) {
            event.preventDefault();
            
            if (editMode.isEditing && editMode.section === 'shopping') {
                // Edit existing item
                const item = data.shopping.find(i => i.id === editMode.itemId);
                if (item) {
                    item.name = document.getElementById('shoppingItem').value;
                    item.category = document.getElementById('shoppingCategory').value;
                    item.cost = document.getElementById('shoppingCost').value;
                    item.priority = document.getElementById('shoppingPriority').value;
                    item.owner = document.getElementById('shoppingOwner').value;
                    item.notes = document.getElementById('shoppingNotes').value;
                }
            } else {
                // Add new item
                const item = {
                    id: Date.now(),
                    name: document.getElementById('shoppingItem').value,
                    category: document.getElementById('shoppingCategory').value,
                    cost: document.getElementById('shoppingCost').value,
                    priority: document.getElementById('shoppingPriority').value,
                    owner: document.getElementById('shoppingOwner').value,
                    notes: document.getElementById('shoppingNotes').value,
                    completed: false
                };
                data.shopping.push(item);
            }
            
            saveData();
            closeModal('shoppingModal');
            event.target.reset();
        }

        function editShoppingItem(id) {
            const item = data.shopping.find(i => i.id === id);
            if (!item) return;

            editMode = { isEditing: true, section: 'shopping', itemId: id };
            
            document.getElementById('shoppingItem').value = item.name;
            document.getElementById('shoppingCategory').value = item.category;
            document.getElementById('shoppingCost').value = item.cost || '';
            document.getElementById('shoppingPriority').value = item.priority;
            document.getElementById('shoppingOwner').value = item.owner || '';
            document.getElementById('shoppingNotes').value = item.notes || '';
            
            document.querySelector('#shoppingModal h2').textContent = 'Edit Shopping Item';
            document.querySelector('#shoppingModal button[type="submit"]').textContent = 'Update Item';
            document.getElementById('shoppingModal').classList.add('active');
        }

        function toggleShoppingItem(id) {
            const item = data.shopping.find(i => i.id === id);
            if (item) {
                item.completed = !item.completed;
                saveData();
            }
        }

        function deleteShoppingItem(id) {
            if (confirm('Are you sure you want to delete this item?')) {
                data.shopping = data.shopping.filter(i => i.id !== id);
                saveData();
            }
        }

        function renderShopping() {
            const container = document.getElementById('shoppingList');
            
            // Update progress bar
            const completed = data.shopping.filter(i => i.completed).length;
            const total = data.shopping.length;
            const progress = total > 0 ? Math.round((completed / total) * 100) : 0;
            document.getElementById('shoppingProgress').style.width = progress + '%';
            document.getElementById('shoppingProgress').textContent = progress + '%';

            if (data.shopping.length === 0) {
                container.innerHTML = '<div class="empty-state"><p>No shopping items yet. Add what you need to buy!</p></div>';
                return;
            }

            let html = '<table><thead><tr><th>Done</th><th>Item</th><th>Category</th><th>Cost</th><th>Priority</th><th>Assigned To</th><th>Actions</th></tr></thead><tbody>';
            data.shopping.forEach(item => {
                const priorityBadge = item.priority === 'high' ? 'badge-danger' : item.priority === 'medium' ? 'badge-warning' : 'badge-info';
                html += `
                    <tr style="${item.completed ? 'opacity: 0.6; text-decoration: line-through;' : ''}">
                        <td><input type="checkbox" ${item.completed ? 'checked' : ''} onchange="toggleShoppingItem(${item.id})"></td>
                        <td><strong>${item.name}</strong></td>
                        <td>${item.category}</td>
                        <td>${item.cost ? '$' + item.cost : 'N/A'}</td>
                        <td><span class="badge ${priorityBadge}">${item.priority}</span></td>
                        <td>${item.owner || 'Unassigned'}</td>
                        <td>
                            <button class="btn btn-primary btn-small" onclick="editShoppingItem(${item.id})" style="margin-right: 5px;">Edit</button>
                            <button class="btn btn-danger btn-small" onclick="deleteShoppingItem(${item.id})">Delete</button>
                        </td>
                    </tr>
                `;
            });
            html += '</tbody></table>';
            container.innerHTML = html;
        }

        // Food Functions
        function addFoodItem(event) {
            event.preventDefault();
            
            if (editMode.isEditing && editMode.section === 'food') {
                // Edit existing item
                const item = data.food.find(f => f.id === editMode.itemId);
                if (item) {
                    item.name = document.getElementById('foodName').value;
                    item.course = document.getElementById('foodCourse').value;
                    item.type = document.getElementById('foodType').value;
                    item.cost = document.getElementById('foodCost').value;
                    item.description = document.getElementById('foodDescription').value;
                    item.selected = document.getElementById('foodSelected').checked;
                }
            } else {
                // Add new item
                const item = {
                    id: Date.now(),
                    name: document.getElementById('foodName').value,
                    course: document.getElementById('foodCourse').value,
                    type: document.getElementById('foodType').value,
                    cost: document.getElementById('foodCost').value,
                    description: document.getElementById('foodDescription').value,
                    selected: document.getElementById('foodSelected').checked
                };
                data.food.push(item);
            }
            
            saveData();
            closeModal('foodModal');
            event.target.reset();
        }

        function editFoodItem(id) {
            const item = data.food.find(f => f.id === id);
            if (!item) return;

            editMode = { isEditing: true, section: 'food', itemId: id };
            
            document.getElementById('foodName').value = item.name;
            document.getElementById('foodCourse').value = item.course;
            document.getElementById('foodType').value = item.type;
            document.getElementById('foodCost').value = item.cost || '';
            document.getElementById('foodDescription').value = item.description || '';
            document.getElementById('foodSelected').checked = item.selected || false;
            
            document.querySelector('#foodModal h2').textContent = 'Edit Menu Item';
            document.querySelector('#foodModal button[type="submit"]').textContent = 'Update Menu Item';
            document.getElementById('foodModal').classList.add('active');
        }

        function deleteFood(id) {
            if (confirm('Are you sure you want to delete this menu item?')) {
                data.food = data.food.filter(f => f.id !== id);
                saveData();
            }
        }

        function renderFood() {
            const container = document.getElementById('foodList');
            if (data.food.length === 0) {
                container.innerHTML = '<div class="empty-state"><p>No menu items yet. Start planning your menu!</p></div>';
                return;
            }

            let html = '';
            data.food.forEach(item => {
                const courseBadge = item.course === 'main' ? 'badge-danger' : item.course === 'appetizer' ? 'badge-warning' : item.course === 'dessert' ? 'badge-info' : 'badge-success';
                html += `
                    <div class="item-card" style="${item.selected ? 'border-left-color: var(--success);' : ''}">
                        <h3>${item.name} ${item.selected ? '‚úì' : ''}</h3>
                        <span class="badge ${courseBadge}">${item.course}</span>
                        <p>üç¥ ${item.type}</p>
                        ${item.cost ? `<p>üí∞ $${item.cost} per plate</p>` : ''}
                        ${item.description ? `<p><em>${item.description}</em></p>` : ''}
                        <div class="item-actions">
                            <button class="btn btn-primary btn-small" onclick="editFoodItem(${item.id})">Edit</button>
                            <button class="btn btn-danger btn-small" onclick="deleteFood(${item.id})">Delete</button>
                        </div>
                    </div>
                `;
            });
            container.innerHTML = html;
        }

        // Budget Functions
        function addBudgetItem(event) {
            event.preventDefault();
            
            if (editMode.isEditing && editMode.section === 'budget') {
                // Edit existing item
                const item = data.budget.find(b => b.id === editMode.itemId);
                if (item) {
                    item.category = document.getElementById('budgetCategory').value;
                    item.description = document.getElementById('budgetDescription').value;
                    item.estimated = parseFloat(document.getElementById('budgetEstimated').value);
                    item.actual = document.getElementById('budgetActual').value ? parseFloat(document.getElementById('budgetActual').value) : 0;
                    item.owner = document.getElementById('budgetOwner').value;
                    item.paid = document.getElementById('budgetPaid').checked;
                }
            } else {
                // Add new item
                const item = {
                    id: Date.now(),
                    category: document.getElementById('budgetCategory').value,
                    description: document.getElementById('budgetDescription').value,
                    estimated: parseFloat(document.getElementById('budgetEstimated').value),
                    actual: document.getElementById('budgetActual').value ? parseFloat(document.getElementById('budgetActual').value) : 0,
                    owner: document.getElementById('budgetOwner').value,
                    paid: document.getElementById('budgetPaid').checked
                };
                data.budget.push(item);
            }
            
            saveData();
            closeModal('budgetModal');
            event.target.reset();
        }

        function editBudgetItem(id) {
            const item = data.budget.find(b => b.id === id);
            if (!item) return;

            editMode = { isEditing: true, section: 'budget', itemId: id };
            
            document.getElementById('budgetCategory').value = item.category;
            document.getElementById('budgetDescription').value = item.description;
            document.getElementById('budgetEstimated').value = item.estimated;
            document.getElementById('budgetActual').value = item.actual || '';
            document.getElementById('budgetOwner').value = item.owner || '';
            document.getElementById('budgetPaid').checked = item.paid || false;
            
            document.querySelector('#budgetModal h2').textContent = 'Edit Expense';
            document.querySelector('#budgetModal button[type="submit"]').textContent = 'Update Expense';
            document.getElementById('budgetModal').classList.add('active');
        }

        function deleteBudget(id) {
            if (confirm('Are you sure you want to delete this expense?')) {
                data.budget = data.budget.filter(b => b.id !== id);
                saveData();
            }
        }

        function renderBudget() {
            const container = document.getElementById('budgetList');
            const summary = document.getElementById('budgetSummary');

            // Calculate totals
            const totalEstimated = data.budget.reduce((sum, item) => sum + item.estimated, 0);
            const totalActual = data.budget.reduce((sum, item) => sum + item.actual, 0);
            const totalPaid = data.budget.filter(item => item.paid).reduce((sum, item) => sum + (item.actual || item.estimated), 0);

            summary.innerHTML = `
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-number">$${totalEstimated.toFixed(2)}</div>
                        <div class="stat-label">Estimated Budget</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, var(--accent) 0%, var(--danger) 100%);">
                        <div class="stat-number">$${totalActual.toFixed(2)}</div>
                        <div class="stat-label">Actual Spent</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, var(--success) 0%, #66bb6a 100%);">
                        <div class="stat-number">$${totalPaid.toFixed(2)}</div>
                        <div class="stat-label">Paid</div>
                    </div>
                </div>
            `;

            if (data.budget.length === 0) {
                container.innerHTML = '<div class="empty-state"><p>No expenses added yet. Start tracking your budget!</p></div>';
                return;
            }

            let html = '<table><thead><tr><th>Category</th><th>Description</th><th>Estimated</th><th>Actual</th><th>Responsible</th><th>Paid</th><th>Actions</th></tr></thead><tbody>';
            data.budget.forEach(item => {
                html += `
                    <tr>
                        <td><strong>${item.category}</strong></td>
                        <td>${item.description}</td>
                        <td>$${item.estimated.toFixed(2)}</td>
                        <td>${item.actual ? '$' + item.actual.toFixed(2) : 'N/A'}</td>
                        <td>${item.owner || 'Unassigned'}</td>
                        <td>${item.paid ? '‚úì Paid' : '‚úó Unpaid'}</td>
                        <td>
                            <button class="btn btn-primary btn-small" onclick="editBudgetItem(${item.id})" style="margin-right: 5px;">Edit</button>
                            <button class="btn btn-danger btn-small" onclick="deleteBudget(${item.id})">Delete</button>
                        </td>
                    </tr>
                `;
            });
            html += '</tbody></table>';
            container.innerHTML = html;
        }

        // Timeline Functions
        function addTimelineItem(event) {
            event.preventDefault();
            
            if (editMode.isEditing && editMode.section === 'timeline') {
                // Edit existing item
                const item = data.timeline.find(t => t.id === editMode.itemId);
                if (item) {
                    item.event = document.getElementById('timelineEvent').value;
                    item.date = document.getElementById('timelineDate').value;
                    item.time = document.getElementById('timelineTime').value;
                    item.location = document.getElementById('timelineLocation').value;
                    item.owner = document.getElementById('timelineOwner').value;
                    item.description = document.getElementById('timelineDescription').value;
                    item.completed = document.getElementById('timelineCompleted').checked;
                }
            } else {
                // Add new item
                const item = {
                    id: Date.now(),
                    event: document.getElementById('timelineEvent').value,
                    date: document.getElementById('timelineDate').value,
                    time: document.getElementById('timelineTime').value,
                    location: document.getElementById('timelineLocation').value,
                    owner: document.getElementById('timelineOwner').value,
                    description: document.getElementById('timelineDescription').value,
                    completed: document.getElementById('timelineCompleted').checked
                };
                data.timeline.push(item);
            }
            
            data.timeline.sort((a, b) => new Date(a.date) - new Date(b.date));
            saveData();
            closeModal('timelineModal');
            event.target.reset();
        }

        function editTimelineItem(id) {
            const item = data.timeline.find(t => t.id === id);
            if (!item) return;

            editMode = { isEditing: true, section: 'timeline', itemId: id };
            
            document.getElementById('timelineEvent').value = item.event;
            document.getElementById('timelineDate').value = item.date;
            document.getElementById('timelineTime').value = item.time || '';
            document.getElementById('timelineLocation').value = item.location || '';
            document.getElementById('timelineOwner').value = item.owner || '';
            document.getElementById('timelineDescription').value = item.description || '';
            document.getElementById('timelineCompleted').checked = item.completed || false;
            
            document.querySelector('#timelineModal h2').textContent = 'Edit Timeline Event';
            document.querySelector('#timelineModal button[type="submit"]').textContent = 'Update Event';
            document.getElementById('timelineModal').classList.add('active');
        }

        function deleteTimeline(id) {
            if (confirm('Are you sure you want to delete this event?')) {
                data.timeline = data.timeline.filter(t => t.id !== id);
                saveData();
            }
        }

        function renderTimeline() {
            const container = document.getElementById('timelineList');
            if (data.timeline.length === 0) {
                container.innerHTML = '<div class="empty-state"><p>No events scheduled yet. Create your wedding timeline!</p></div>';
                return;
            }

            let html = '<table><thead><tr><th>Done</th><th>Event</th><th>Date</th><th>Time</th><th>Location</th><th>Assigned To</th><th>Actions</th></tr></thead><tbody>';
            data.timeline.forEach(item => {
                const date = new Date(item.date);
                const formattedDate = date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
                html += `
                    <tr style="${item.completed ? 'opacity: 0.6;' : ''}">
                        <td>${item.completed ? '‚úì' : '‚óã'}</td>
                        <td><strong>${item.event}</strong>${item.description ? '<br><small>' + item.description + '</small>' : ''}</td>
                        <td>${formattedDate}</td>
                        <td>${item.time || 'N/A'}</td>
                        <td>${item.location || 'N/A'}</td>
                        <td>${item.owner || 'Unassigned'}</td>
                        <td>
                            <button class="btn btn-primary btn-small" onclick="editTimelineItem(${item.id})" style="margin-right: 5px;">Edit</button>
                            <button class="btn btn-danger btn-small" onclick="deleteTimeline(${item.id})">Delete</button>
                        </td>
                    </tr>
                `;
            });
            html += '</tbody></table>';
            container.innerHTML = html;
        }

        // Dashboard
        function renderDashboard() {
            const statsContainer = document.getElementById('dashboardStats');
            const overviewContainer = document.getElementById('quickOverview');
            const tasksByPersonContainer = document.getElementById('tasksByPerson');

            // Calculate stats
            const totalGuests = data.guests.length;
            const confirmedGuests = data.guests.filter(g => g.rsvp === 'confirmed').length;
            
            // Calculate total persons (including all people each guest is bringing)
            let totalPersons = 0;
            let confirmedPersons = 0;
            data.guests.forEach(guest => {
                let persons = 1;
                if (guest.persons) {
                    persons = guest.persons;
                } else if (guest.plusOne === 'yes') {
                    persons = 2;
                }
                totalPersons += persons;
                if (guest.rsvp === 'confirmed') {
                    confirmedPersons += persons;
                }
            });
            
            const totalBudget = data.budget.reduce((sum, item) => sum + item.estimated, 0);
            const completedTasks = data.shopping.filter(i => i.completed).length;
            const totalTasks = data.shopping.length;

            statsContainer.innerHTML = `
                <div class="stat-card">
                    <div class="stat-number">${totalPersons}</div>
                    <div class="stat-label">Total Guests Expected</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #66bb6a 0%, #4caf50 100%);">
                    <div class="stat-number">${confirmedPersons}</div>
                    <div class="stat-label">Guests Confirmed</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, var(--accent) 0%, var(--danger) 100%);">
                    <div class="stat-number">$${totalBudget.toFixed(0)}</div>
                    <div class="stat-label">Total Budget</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, var(--success) 0%, #66bb6a 100%);">
                    <div class="stat-number">${completedTasks}/${totalTasks}</div>
                    <div class="stat-label">Tasks Completed</div>
                </div>
            `;

            // Tasks by Person
            const tasksByPerson = {};
            
            // Collect all tasks with owners
            [...data.shopping, ...data.budget, ...data.timeline, ...data.venues].forEach(item => {
                if (item.owner && item.owner.trim() !== '') {
                    const owner = item.owner.trim();
                    if (!tasksByPerson[owner]) {
                        tasksByPerson[owner] = {
                            total: 0,
                            completed: 0,
                            pending: 0,
                            shopping: 0,
                            budget: 0,
                            timeline: 0,
                            venues: 0
                        };
                    }
                    tasksByPerson[owner].total++;
                    
                    // Categorize by type
                    if (data.shopping.includes(item)) {
                        tasksByPerson[owner].shopping++;
                        if (item.completed) tasksByPerson[owner].completed++;
                        else tasksByPerson[owner].pending++;
                    } else if (data.budget.includes(item)) {
                        tasksByPerson[owner].budget++;
                        if (item.paid) tasksByPerson[owner].completed++;
                        else tasksByPerson[owner].pending++;
                    } else if (data.timeline.includes(item)) {
                        tasksByPerson[owner].timeline++;
                        if (item.completed) tasksByPerson[owner].completed++;
                        else tasksByPerson[owner].pending++;
                    } else if (data.venues.includes(item)) {
                        tasksByPerson[owner].venues++;
                        if (item.status === 'booked') tasksByPerson[owner].completed++;
                        else tasksByPerson[owner].pending++;
                    }
                }
            });

            let tasksByPersonHtml = '';
            if (Object.keys(tasksByPerson).length === 0) {
                tasksByPersonHtml = '<p style="color: var(--text-light);">No tasks assigned yet. Add "Assigned To" when creating tasks to see breakdown by person.</p>';
            } else {
                tasksByPersonHtml = '<div class="grid">';
                Object.entries(tasksByPerson).forEach(([person, stats]) => {
                    const completionRate = stats.total > 0 ? Math.round((stats.completed / stats.total) * 100) : 0;
                    tasksByPersonHtml += `
                        <div class="item-card" style="border-left-color: ${completionRate === 100 ? 'var(--success)' : 'var(--primary)'};">
                            <h3>üë§ ${person}</h3>
                            <p><strong>${stats.total}</strong> total tasks</p>
                            <p>‚úÖ ${stats.completed} completed | ‚è≥ ${stats.pending} pending</p>
                            ${stats.shopping > 0 ? `<p>üõçÔ∏è ${stats.shopping} shopping</p>` : ''}
                            ${stats.budget > 0 ? `<p>üí∞ ${stats.budget} budget</p>` : ''}
                            ${stats.timeline > 0 ? `<p>üìÖ ${stats.timeline} timeline</p>` : ''}
                            ${stats.venues > 0 ? `<p>üèõÔ∏è ${stats.venues} venue</p>` : ''}
                            <div class="progress-bar" style="height: 20px; margin-top: 10px;">
                                <div class="progress-fill" style="width: ${completionRate}%;">${completionRate}%</div>
                            </div>
                        </div>
                    `;
                });
                tasksByPersonHtml += '</div>';
            }
            tasksByPersonContainer.innerHTML = tasksByPersonHtml;

            // Quick overview
            const bookedVenue = data.venues.find(v => v.status === 'booked');
            const upcomingEvents = data.timeline.filter(e => !e.completed).slice(0, 3);
            const roomsNeeded = data.guests.filter(g => g.roomRequired).length;

            let overviewHtml = '<h3 style="margin-bottom: 15px;">Quick Overview</h3>';
            
            overviewHtml += `<p><strong>üë• Guest Count:</strong> ${confirmedPersons} confirmed out of ${totalPersons} expected guests</p>`;
            
            if (bookedVenue) {
                overviewHtml += `<p><strong>‚úì Venue Booked:</strong> ${bookedVenue.name} at ${bookedVenue.location}</p>`;
            }

            if (roomsNeeded > 0) {
                overviewHtml += `<p><strong>üè® Accommodation Needed:</strong> ${roomsNeeded} guest${roomsNeeded > 1 ? 's' : ''} require${roomsNeeded === 1 ? 's' : ''} rooms</p>`;
            }

            if (upcomingEvents.length > 0) {
                overviewHtml += '<p><strong>Upcoming Events:</strong></p><ul style="margin-left: 20px;">';
                upcomingEvents.forEach(event => {
                    const date = new Date(event.date);
                    const owner = event.owner ? ` (${event.owner})` : '';
                    overviewHtml += `<li>${event.event} - ${date.toLocaleDateString()}${owner}</li>`;
                });
                overviewHtml += '</ul>';
            }

            const highPriority = data.shopping.filter(i => i.priority === 'high' && !i.completed);
            if (highPriority.length > 0) {
                overviewHtml += `<p style="margin-top: 15px;"><strong>‚ö†Ô∏è High Priority Items:</strong> ${highPriority.length} items need attention</p>`;
            }

            overviewContainer.innerHTML = overviewHtml;
        }

        // Render All
        function renderAll() {
            renderDashboard();
            renderGuests();
            renderVenues();
            renderShopping();
            renderFood();
            renderBudget();
            renderTimeline();
        }

        // Export Data
        function exportData() {
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            const date = new Date().toISOString().split('T')[0];
            link.download = `wedding-planner-backup-${date}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            alert('‚úÖ Data exported successfully! Save this file to backup your wedding plans.');
        }

        // Import Data
        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    // Validate the imported data has the correct structure
                    if (importedData.guests && importedData.venues && importedData.shopping && 
                        importedData.food && importedData.budget && importedData.timeline) {
                        
                        if (confirm('This will replace all current data. Are you sure you want to import?')) {
                            data = importedData;
                            saveData();
                            alert('‚úÖ Data imported successfully! Your wedding plans have been restored.');
                        }
                    } else {
                        alert('‚ùå Invalid file format. Please select a valid wedding planner backup file.');
                    }
                } catch (error) {
                    alert('‚ùå Error reading file. Please select a valid JSON backup file.');
                }
            };
            reader.readAsText(file);
            
            // Reset the input so the same file can be imported again if needed
            event.target.value = '';
        }

        // Auto-save reminder
        function showAutoSaveStatus() {
            const lastSaved = localStorage.getItem('weddingPlannerData');
            if (lastSaved) {
                console.log('‚úÖ Auto-save is working. Your data is being saved automatically.');
            }
        }

        // Initialize
        loadData();
        showAutoSaveStatus();

        // Close modals when clicking outside
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.classList.remove('active');
            }
        }
    </script>
</body>
</html>

